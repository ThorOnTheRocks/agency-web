---
import Layout from '../layouts/Layout.astro';
import { GuestbookSection } from '../components/react/GuestbookSection';
import { db } from '../db/client';
import { guestbook } from '../db/schema';
import { desc } from 'drizzle-orm';

// Server-side logic: Fetch existing entries
// This runs on the server every time the page is requested (if output: server)
const entries = await db.select().from(guestbook).orderBy(desc(guestbook.createdAt)).limit(20);
---

<Layout title="Guestbook">
  <main class="max-w-2xl mx-auto px-4 py-12">
    <h1 class="text-4xl font-bold tracking-tight mb-2">Guestbook</h1>
    <p class="text-muted-foreground mb-8">Leave your mark on the internet.</p>
    
    <GuestbookSection client:only="react" initialEntries={entries} />
  </main>
</Layout>